---
import { languages } from "../i18n/ui";
import { useTranslations } from "../utils/i18n";
const { lang = "en" } = Astro.props;
const t = useTranslations(lang);
const currentLangName =
    languages[lang as keyof typeof languages] || languages["en"];
---

<header id="main-header">
    <nav class="nav-container">
        <a href={`/${lang === "en" ? "" : lang}`} class="logo">
            <i class="fab fa-tiktok"></i> SaveTikFast
        </a>

        <!-- Language Selector (Simple Dropdown or Link) -->
        <div class="lang-select" tabindex="0">
            <div class="lang-selector">
                <button
                    class="theme-toggle"
                    id="theme-btn"
                    aria-label="Toggle Theme"
                >
                    <i class="fas fa-moon"></i>
                </button>
                <div class="dropdown-trigger" id="lang-btn">
                    <span
                        >{
                            languages[lang as keyof typeof languages] ||
                                languages["en"]
                        }</span
                    >
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="dropdown-options" id="lang-options">
                    {
                        Object.entries(languages).map(([code, name]) => (
                            <a
                                href={code === "en" ? "/" : `/${code}`}
                                class="option-item"
                            >
                                {name}
                            </a>
                        ))
                    }
                </div>
            </div>
        </div>
    </nav>

    <nav class="nav-menu" aria-label="Download Types">
        <a
            href={`/${lang === "en" ? "" : lang}`}
            class={!Astro.url.pathname.includes("mp3") &&
            !Astro.url.pathname.includes("story")
                ? "active"
                : ""}
            title={t("hero.title")}
        >
            <i class="fas fa-video"></i>
            <span>{t("nav_menu.video")}</span>
        </a>
        <a
            href={`/${lang === "en" ? "mp3" : lang + "/mp3"}`}
            class={Astro.url.pathname.includes("mp3") ? "active" : ""}
            title={t("mp3_page.meta_title")}
        >
            <i class="fas fa-music"></i>
            <span>{t("nav_menu.mp3")}</span>
        </a>
        <a
            href={`/${lang === "en" ? "story" : lang + "/story"}`}
            class={Astro.url.pathname.includes("story") ? "active" : ""}
            title={t("story_page.meta_title")}
        >
            <i class="fas fa-images"></i>
            <span>{t("nav_menu.stories")}</span>
        </a>
    </nav>

    <script>
        // Theme Toggle Logic
        const themeBtn = document.getElementById("theme-btn");
        if (themeBtn) {
            themeBtn.addEventListener("click", () => {
                // @ts-ignore
                if (typeof handleToggleClick === "function") {
                    // @ts-ignore
                    handleToggleClick();
                    // Update icon
                    const icon = themeBtn.querySelector("i");
                    if (icon) {
                        const isDark =
                            !document.documentElement.hasAttribute(
                                "data-theme",
                            );
                        icon.className = isDark ? "fas fa-moon" : "fas fa-sun";
                    }
                }
            });

            // Initialize icon on load
            const icon = themeBtn.querySelector("i");
            if (icon) {
                const isDark =
                    !document.documentElement.hasAttribute("data-theme");
                icon.className = isDark ? "fas fa-moon" : "fas fa-sun";
            }
        }

        // Language Dropdown Logic
        const langBtn = document.getElementById("lang-btn");
        const langOptions = document.getElementById("lang-options");

        if (langBtn && langOptions) {
            langBtn.addEventListener("click", (e) => {
                e.stopPropagation();
                langOptions.classList.toggle("show");
                langBtn.classList.toggle("active");
            });

            document.addEventListener("click", (e) => {
                if (
                    !langBtn.contains(e.target as Node) &&
                    !langOptions.contains(e.target as Node)
                ) {
                    langOptions.classList.remove("show");
                    langBtn.classList.remove("active");
                }
            });
        }
    </script>

    <style>
        .dropdown-options.show {
            display: grid !important;
        }
    </style>
</header>
