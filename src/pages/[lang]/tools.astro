---
import Layout from "../../layouts/Layout.astro";
import Downloader from "../../components/Downloader.jsx";
import ToolsTabs from "../../components/tools/ToolsTabs.jsx";
import { languages } from "../../i18n/ui";
import { useTranslations, getTranslations } from "../../utils/i18n";
import AdBanner from "../../components/AdBanner.astro";
import NotFound from "../../components/NotFound.astro";

export const prerender = true;

const { lang } = Astro.params;
const isValidLang = lang && languages[lang as keyof typeof languages];

if (!isValidLang) {
    Astro.response.status = 404;
    Astro.response.statusText = "Not Found";
}

export function getStaticPaths() {
    return Object.keys(languages).map((lang) => ({ params: { lang } }));
}

const currentLang = (isValidLang ? lang : "en") as keyof typeof languages;
const t = useTranslations(currentLang);
const translations = getTranslations(currentLang);

const tools = [
    { icon: "fas fa-history", key: "story_downloader", href: "story" },
    { icon: "fas fa-headphones", key: "mp3_downloader", href: "mp3" },
    { icon: "fas fa-images", key: "slideshow_downloader", href: "slideshow" },
];
---

{
    isValidLang ? (
        <Layout
            title={t("tools.meta.title")}
            description={t("tools.meta.description")}
            lang={currentLang}
        >
            <article class="hero-section">
                <h1>
                    <i class="fas fa-tools accent-icon" />
                    {t("tools.hero.title")}
                </h1>
                <p>{t("tools.hero.desc")}</p>

                <ToolsTabs client:load translations={translations} />
            </article>

            <AdBanner />

            <div class="section-divider">
                <h3>{t("blog.tools_heading") || "More Tools"}</h3>
            </div>

            <div class="container features-grid">
                {tools.map((tool) => (
                    <a href={`/${lang}/${tool.href}`} class="feature-card">
                        <div class="icon-box">
                            <i class={tool.icon} />
                        </div>
                        <h3>{t(`tools.${tool.key}`) || tool.key}</h3>
                        <p>{t(`tools.${tool.key}_desc`)}</p>
                    </a>
                ))}
            </div>
        </Layout>
    ) : (
        <NotFound />
    )
}

<style>
    .accent-icon {
        color: var(--secondary);
    }
</style>
