---
export const prerender = true;
import Layout from "../layouts/Layout.astro";
import Downloader from "../components/Downloader.jsx";
import FAQ from "../components/FAQ.astro";
import {
  getLangFromUrl,
  useTranslations,
  getTranslations,
} from "../utils/i18n";
import { ui, defaultLang } from "../i18n/ui";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translations = getTranslations(lang);
const defaultTranslations = ui[defaultLang];

// --- Robust FAQ Array Generation ---
// Converts 'faq' object (q1..q10) into the array format expected by FAQ.astro
const faqItems = [];
if (translations && translations.faq) {
  for (let i = 1; i <= 20; i++) {
    const qKey = `q${i}`;
    const aKey = `a${i}`;
    if (translations.faq[qKey] && translations.faq[aKey]) {
      faqItems.push({
        question: translations.faq[qKey],
        answer: translations.faq[aKey],
      });
    }
  }
}

// --- Safe Downloader Messages ---
// Merges current language messages with English defaults to prevent empty buttons
const downloaderMessages = {
  ...defaultTranslations.downloader,
  ...(translations.downloader || {}),
};
---

<Layout title={t("meta.title")} description={t("meta.description")} lang={lang}>
  <div class="main-wrapper">
    <article
      class="hero-section text-center w-full flex flex-col items-center justify-center"
    >
      <h1 class="text-2xl md:text-4xl font-bold mb-4">
        {t("hero.title")}
        <span style="color: var(--secondary);"
          >({t("downloader.hd_quality")})</span
        >
      </h1>
      <p class="text-base md:text-lg mb-8 max-w-2xl mx-auto">
        {t("hero.desc")}
      </p>

      <!-- Client-Side Downloader -->
      <div class="w-full max-w-3xl mx-auto">
        <Downloader client:load messages={downloaderMessages} />
      </div>
    </article>
  </div>

  <!-- Features Grid (Static) -->
  <section class="container features-grid">
    <div class="feature-card">
      <i class="fas fa-magic"></i>
      <h3>{t("features.no_watermark.title")}</h3>
      <p>{t("features.no_watermark.desc")}</p>
    </div>
    <div class="feature-card">
      <i class="fas fa-bolt"></i>
      <h3>{t("features.fast.title")}</h3>
      <p>{t("features.fast.desc")}</p>
    </div>
    <div class="feature-card">
      <i class="fas fa-hd"></i>
      <h3>{t("features.quality.title")}</h3>
      <p>{t("features.quality.desc")}</p>
    </div>
    <div class="feature-card">
      <i class="fas fa-mobile-alt"></i>
      <h3>{t("features.device.title")}</h3>
      <p>{t("features.device.desc")}</p>
    </div>
    <div class="feature-card">
      <i class="fas fa-infinity"></i>
      <h3>{t("features.unlimited.title")}</h3>
      <p>{t("features.unlimited.desc")}</p>
    </div>
    <div class="feature-card">
      <i class="fas fa-shield-alt"></i>
      <h3>{t("features.safe.title")}</h3>
      <p>{t("features.safe.desc")}</p>
    </div>
  </section>

  <FAQ t={t} items={faqItems} />
</Layout>
